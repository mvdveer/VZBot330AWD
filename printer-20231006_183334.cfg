
##########################################################################
## Included Configs
##########################################################################

[include macros.cfg]
[include neopixel.cfg]
#[include nozzle_scrub.cfg]
#[include timelapse.cfg]
#[include variables.cfg]
[include Adaptive_Mesh.cfg]
[include Adaptive_Purge.cfg]\
[include speed.cfg]
[include beacon.cfg]
[include VZBot macro.cfg]

[exclude_object]

##########################################################################
## Mainsail inclusions
##########################################################################

[display_status]

[exclude_object]

[virtual_sdcard]
path: /home/pi/printer_data/gcodes

[pause_resume]

recover_velocity: 350

##########################################################################
## MCU Section
##########################################################################

[mcu sht36]
canbus_uuid: 21da7204a07b

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_3E0014001050334636383920-if00


##########################################################################
## Printer
##########################################################################

[printer]
kinematics: corexy
max_velocity: 500                    # VZBot = 2500   Voron = 500
max_accel: 3000                      # VZBOT = 10000  Voron = 3000 
max_accel_to_decel: 8100             # VZBot = 5000   Voron = 8100
max_z_velocity: 10                   # VZBot = 20     Voron = 10
max_z_accel: 350                     # VZBot = 1500   Voron = 350
square_corner_velocity: 5            # VZBot = 10     Voron = 5

##########################################################################
#  Resonance - Input Shaper - SHT36
##########################################################################

## SHT36 -ADXL345
[adxl345]
cs_pin: sht36:PA9
spi_software_sclk_pin: sht36:PB13
spi_software_mosi_pin: sht36:PB15
spi_software_miso_pin: sht36:PB14

[resonance_tester]
accel_chip: adxl345
probe_points:
    160, 160, 20

[input_shaper]
shaper_freq_x: 84
shaper_type_x: mzv
shaper_freq_y: 47.4
shaper_type_y: zv


##########################################################################
# SHT36 Temperature sensors
##########################################################################

[temperature_sensor SHT36-V2]     
sensor_type: temperature_mcu      
sensor_mcu: sht36               
min_temp: 0                       
max_temp: 490                     


[temperature_sensor Chamber]          
sensor_type: ATC Semitec 104GT-2  
sensor_pin = sht36:PA4          
min_temp: 0                       
max_temp: 490           

##########################################################################
# Octopus Pros 429 SPI Fix
##########################################################################

# [static_digital_output disable_max31865]
# pins: !PF8


##########################################################################
## Steppers - AWD - TMC 5160 Pro
##########################################################################

[stepper_x]
##	in M0 position
step_pin: PF13
dir_pin: !PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 16
full_steps_per_rotation: 200  
endstop_pin: ^sht36:PA1            # make sure to set the correct pin here.
position_endstop: 335
position_min: 0                   # 0
position_max: 335
homing_speed: 120 
homing_retract_dist: 5


[tmc2209 stepper_x]                     
uart_pin: PC4
interpolate: false
run_current: 1.2                # 0.8
sense_resistor: 0.110
stealthchop_threshold: 0         # 999999

# [tmc5160 stepper_x] 
# #spi_bus: spi1
# cs_pin: PC4
# #diag_pin: PA8
# interpolate: false
# run_current: 1.9
# sense_resistor: 0.033
# spi_software_mosi_pin: PA7
# spi_software_miso_pin: PA6
# spi_software_sclk_pin: PA5
# #driver_SGT: -64 # -64 is most sensitive value, 63 is least sensitive
# driver_TBL: 1
# driver_TOFF: 3
# driver_DISS2G: 1
# driver_DISS2VS: 1

[stepper_y]
##	in M1 position
step_pin: PG0
dir_pin: !PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 16
full_steps_per_rotation: 200
endstop_pin: PG6                 #make sure to set the correct pin here.
position_endstop: 325
position_min: 36
position_max: 330
homing_speed: 120 
homing_retract_dist: 5


[tmc2209 stepper_y]               
uart_pin: PD11
interpolate: false
run_current: 1.2                # 0.8
sense_resistor: 0.110
stealthchop_threshold: 0        # 999999

# [tmc5160 stepper_y] 
# #spi_bus: spi1
# cs_pin: PD11
# #diag_pin: PA8
# interpolate: false
# run_current: 1.9
# sense_resistor: 0.033
# spi_software_mosi_pin: PA7
# spi_software_miso_pin: PA6
# spi_software_sclk_pin: PA5
# #driver_SGT: -64 # -64 is most sensitive value, 63 is least sensitive
# driver_TBL: 1
# driver_TOFF: 3
# driver_DISS2G: 1
# driver_DISS2VS: 1

[stepper_x1]
##	in M2_1 position
step_pin: PF11
dir_pin: !PG3
enable_pin: !PG5
rotation_distance: 40
microsteps: 16
full_steps_per_rotation: 200  


[tmc2209 stepper_x1]               
uart_pin: PC6
interpolate: false
run_current: 1.2                # 0.8
sense_resistor: 0.110
stealthchop_threshold: 0         # 999999

# [tmc5160 stepper_x1] 
# #spi_bus: spi1
# cs_pin: PC6
# #diag_pin: PA8
# interpolate: false
# run_current: 1.9
# sense_resistor: 0.033
# spi_software_mosi_pin: PA7
# spi_software_miso_pin: PA6
# spi_software_sclk_pin: PA5
# #driver_SGT: -64 # -64 is most sensitive value, 63 is least sensitive
# driver_TBL: 1
# driver_TOFF: 3
# driver_DISS2G: 1
# driver_DISS2VS: 1

[stepper_y1]
##	in M3 position
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 40
microsteps: 16
full_steps_per_rotation: 200

[tmc2209 stepper_y1]              
uart_pin: PC7
interpolate: false
run_current: 1.2                # 0.8
sense_resistor: 0.110
stealthchop_threshold: 0            # 999999

# [tmc5160 stepper_y1] 
# #spi_bus: spi1
# cs_pin: PC7
# #diag_pin: PA8
# interpolate: false
# run_current: 1.9
# sense_resistor: 0.033
# spi_software_mosi_pin: PA7
# spi_software_miso_pin: PA6
# spi_software_sclk_pin: PA5
# #driver_SGT: -64 # -64 is most sensitive value, 63 is least sensitive
# driver_TBL: 1
# driver_TOFF: 3
# driver_DISS2G: 1
# driver_DISS2VS: 1

##########################################################################
# Steppers - Other - TMC2209
##########################################################################

[stepper_z]
## In M4 position
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
microsteps: 32
rotation_distance: 4
endstop_pin: probe:z_virtual_endstop    # use beacon as virtual endstop
homing_retract_dist: 0                            # Beacon does not require a homing retract. Setting this to something other than 0 will cause occasional erroneous results.
position_max: 400
position_min: -10
full_steps_per_rotation: 200
homing_positive_dir: false
homing_speed: 10.0
second_homing_speed: 5

[tmc2209 stepper_z]
uart_pin: PF2
interpolate: false
run_current: 1.2
sense_resistor: 0.110
stealthchop_threshold: 0              # 999999

[extruder]
## on Canbus SHT36
### Orbiter 2
step_pin: sht36:PB4
dir_pin: sht36:PB3
enable_pin: !sht36:PA15
microsteps: 16
## Orbiter Extruder
rotation_distance: 4.7226
#Gear_ratio: 50:8
nozzle_diameter: 0.4
filament_diameter: 1.750
heater_pin: sht36:PA8
#sensor_type: ATC Semitec 104GT-2  # this is the default for the Revo heater
sensor_type: ATC Semitec 104NT-4-R025H42G         # Rapido UHF
pullup_resistor: 4700   
sensor_pin: sht36:PA3
#control: pid
#pid_Kp=28.737 
#pid_Ki=1.935 
#pid_Kd=106.684
min_temp: 0
max_temp: 400
full_steps_per_rotation: 200
max_extrude_only_distance: 1000.0
max_extrude_cross_section: 500
max_extrude_only_velocity: 200
max_extrude_only_accel: 10000
min_extrude_temp: 0
pressure_advance: 0.04
pressure_advance_smooth_time: 0.04

[tmc2209 extruder]
uart_pin: sht36:PB5
interpolate: false
run_current: 0.7
sense_resistor: 0.110
stealthchop_threshold: 0        # 999999

##########################################################################â€¨# Heater Bed
##########################################################################

[heater_bed]
heater_pin: PA1
sensor_type: Generic 3950
sensor_pin: PF3
#control: pid
#pid_Kp: 66.746
#pid_Ki: 3.504
#pid_Kd: 317.878
min_temp: 0
max_temp: 130


##########################################################################
#FANS
##########################################################################

[fan]
##	Print Cooling Fan - SHT36 - Fan1
pin: sht36:PB11
max_power: 1
cycle_time: 0.002
hardware_pwm: false
shutdown_speed: 0

[heater_fan hotend_fan]
##	Hotend Fan - SHT36 FAN0 Connector
pin: sht36:PB10
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0

[fan_generic Exhaust_fan]
##  exhaust fan - In FAN0
pin: PA8
max_power: 1
shutdown_speed: 0
kick_start_time: 0.1
off_below: 0.10

#[fan_generic chamber_fan]
###  chamber fan - In FAN9 Position
#pin: PD15
#max_power: 1
#shutdown_speed: 0
#kick_start_time: 0.1
#off_below: 0.10

[fan_generic RSCS]
##  RSCS Fans - In FAN1 Position
pin: PE5
max_power: 1
shutdown_speed: 0
kick_start_time: 0.1
off_below: 0.10


##########################################################################
#Custom PINs Definition 
##########################################################################

[output_pin Caselight]
# Connected to HE0
pin: PA2
pwm: false
value: 1
shutdown_value:0

[idle_timeout]
timeout: 1800
gcode =
  {% if printer.pause_resume.is_paused %}
    M104 S0
  {% else %}
    TURN_OFF_HEATERS
    #M84
  {% endif %}

########################################################################
## Probe          Beacon Probe Replaces This.                                                                                                            
########################################################################
# Ess beacon.cfg

##########################################################################
## Homing 
##########################################################################

[safe_z_home]
home_xy_position: 155, 155                 #   Sets the x, y position used for z homing with beacon - update for your machine
z_hop: 3                                   #   Retracts the z axis before x, y homing to avoid dragging the nozzle. 


##########################################################################
## Bed Mesh
##########################################################################

# see beacon.cfg


#[bed_screws]
#screw1: 20,20              # Left Front
#screw2: 155,20.           # Middle Front
#screw3: 290,20           # Right Front
#screw4: 20,290.          # Left back
#screw5: 155,290.        # Middle Back
#screw6: 290,290.        # Right Back

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 24.891
#*# pid_ki = 2.477
#*# pid_kd = 62.538
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 46.371
#*# pid_ki = 1.350
#*# pid_kd = 398.215
#*#
#*# [beacon model default]
#*# model_coef = 1.486466645009539,
#*# 	1.8220366197498756,
#*# 	0.7490774203119954,
#*# 	0.28580891638211625,
#*# 	0.4079077554477875,
#*# 	0.575317039323508,
#*# 	-0.3260427749730116,
#*# 	-0.6239502228606866,
#*# 	0.28298491615625376,
#*# 	0.34218384968431687
#*# model_domain = 3.1801775263960335e-07,3.3258079892662055e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 25.135320
#*# model_offset = 0.15000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.301254, -0.230768, -0.174976, -0.117144, -0.061913, 0.001019, 0.055113, 0.111964, 0.171008, 0.226394, 0.281811, 0.333328, 0.387359, 0.436916, 0.314785
#*# 	  -0.325921, -0.264133, -0.202972, -0.141842, -0.087084, -0.026451, 0.035088, 0.097916, 0.160415, 0.215727, 0.269878, 0.325265, 0.380478, 0.432181, 0.485684
#*# 	  -0.340300, -0.275772, -0.213984, -0.153800, -0.100090, -0.033269, 0.026658, 0.087504, 0.148284, 0.199649, 0.262000, 0.314735, 0.374522, 0.431650, 0.488313
#*# 	  -0.347975, -0.281818, -0.217481, -0.160398, -0.099660, -0.037160, 0.022286, 0.081321, 0.145445, 0.205894, 0.261488, 0.313271, 0.370739, 0.435083, 0.495227
#*# 	  -0.353229, -0.288589, -0.223996, -0.164805, -0.105292, -0.041372, 0.013865, 0.076090, 0.142516, 0.212143, 0.269584, 0.321680, 0.384263, 0.450049, 0.509089
#*# 	  -0.377105, -0.311638, -0.248494, -0.188727, -0.126344, -0.061159, -0.000830, 0.058109, 0.130090, 0.203434, 0.268646, 0.329347, 0.397172, 0.465252, 0.525738
#*# 	  -0.408011, -0.343078, -0.278298, -0.214490, -0.149969, -0.080795, -0.016512, 0.046407, 0.117899, 0.197661, 0.266612, 0.330343, 0.402550, 0.471092, 0.529831
#*# 	  -0.424896, -0.359097, -0.298218, -0.233132, -0.167839, -0.096697, -0.028808, 0.039707, 0.112248, 0.189944, 0.259463, 0.327837, 0.404925, 0.474673, 0.537521
#*# 	  -0.450229, -0.380888, -0.315190, -0.253091, -0.189691, -0.114349, -0.043781, 0.028268, 0.101155, 0.178036, 0.246665, 0.319195, 0.396063, 0.465035, 0.534307
#*# 	  -0.476475, -0.406513, -0.336396, -0.274850, -0.209374, -0.133610, -0.060211, 0.012325, 0.087351, 0.165272, 0.237033, 0.309233, 0.385645, 0.452645, 0.526860
#*# 	  -0.501906, -0.431900, -0.358809, -0.289548, -0.224198, -0.151450, -0.077684, -0.003159, 0.074530, 0.152041, 0.226668, 0.300244, 0.373454, 0.446670, 0.521872
#*# 	  -0.518965, -0.450129, -0.378530, -0.304537, -0.233280, -0.159763, -0.088471, -0.011627, 0.064707, 0.143043, 0.219795, 0.294212, 0.372542, 0.452737, 0.528306
#*# 	  -0.523858, -0.454052, -0.381377, -0.307809, -0.235384, -0.160401, -0.085972, -0.009288, 0.071196, 0.150403, 0.225907, 0.299374, 0.379764, 0.467115, 0.542859
#*# 	  -0.525602, -0.451518, -0.375599, -0.303283, -0.229461, -0.150440, -0.073457, 0.003962, 0.084606, 0.166109, 0.242981, 0.317179, 0.398943, 0.487102, 0.568101
#*# 	  -0.521637, -0.445450, -0.367544, -0.293576, -0.217923, -0.136510, -0.053706, 0.024266, 0.107896, 0.188087, 0.266554, 0.342232, 0.426697, 0.512424, 0.599275
#*# x_count = 15
#*# y_count = 15
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 280.0
#*# min_y = 40.0
#*# max_y = 280.0
